#!/usr/bin/env ruby
require 'fileutils'

# Converts a png file to a box-shadow declaration
class PngToCss
  def initialize(*args)
    @input = args[0]
  end

  def run
    puts 'Reading image'
    matrix = `convert #{@input} txt:- | tail -n +2`.strip

    puts 'Generating box-shadow'
    shadow = []
    matrix.each_line do |line|
      coords, _, hexa = line.split(' ')
      x, y = coords.tr(':', '').split(',')
      next if hexa.length == 9
      shadow << "#{x}px #{y}px 0px #{hexa}"
    end

    output = "<div style='display:block;width:1px;height:1px;background:transparent;box-shadow:#{shadow.join(",")}'></div>"
    File.write('./output.html', output)
  end
end
PngToCss.new(*ARGV).run
